<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Is my connection really secure? &#8211; The Kitchen</title>
<meta name="description" content="">
<meta name="keywords" content="">
<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://thesp0nge.com/images/">
<meta name="twitter:title" content="Is my connection really secure?">
<meta name="twitter:description" content="Un blog che unisce foto, musica, vino, ricette e considerazioni sparse.">
<meta name="twitter:creator" content="@thesp0nge">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Is my connection really secure?">
<meta property="og:description" content="Un blog che unisce foto, musica, vino, ricette e considerazioni sparse.">
<meta property="og:url" content="http://thesp0nge.com/blog/is-my-connection-really-secure">
<meta property="og:site_name" content="The Kitchen">





<link rel="canonical" href="http://thesp0nge.com/blog/is-my-connection-really-secure">
<link href="http://thesp0nge.com/feed.xml" type="application/atom+xml" rel="alternate" title="The Kitchen Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="http://thesp0nge.com/stylesheets/main.min.css">

<!--[if (lt IE 9) & (!IEMobile)]>
<link rel="stylesheet" href="http://thesp0nge.com/stylesheets/ie.min.css">
<![endif]-->

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://thesp0nge.com/javascripts/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://thesp0nge.com/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://thesp0nge.com/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://thesp0nge.com/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://thesp0nge.com/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://thesp0nge.com/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://thesp0nge.com/images/apple-touch-icon-144x144-precomposed.png">

<script type="text/javascript">
//<![CDATA[
  (function() {
    var shr = document.createElement('script');
    shr.setAttribute('data-cfasync', 'false');
    shr.src = '//dsms0mj1bbhn4.cloudfront.net/assets/pub/shareaholic.js';
    shr.type = 'text/javascript'; shr.async = 'true';
    shr.onload = shr.onreadystatechange = function() {
      var rs = this.readyState;
      if (rs && rs != 'complete' && rs != 'loaded') return;
      var apikey = 'c5185a9d72e7109a2751eeb16046c3b4';
      try { Shareaholic.init(apikey); } catch (e) {}
    };
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(shr, s);
  })();
//]]>
</script>


</head>

<body class="article" itemscope itemtype="http://schema.org/WebPage">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://thesp0nge.com">The Kitchen</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
		    <ul>
		        
				<li><a href="http://thesp0nge.com/about" >Su di me</a></li>
		        
				<li><a href="http://thesp0nge.com/la-dispensa" >La dispensa</a></li>
		        
				<li><a href="http://thesp0nge.com/parlami" >Parlami</a></li>
		        
				<li><a href="http://armoredcode.com" target="_blank">Armoredcode</a></li>
		        
		        <li><i class="icon-feed"></i> <a href="http://thesp0nge.com/feed.xml" title="Atom/RSS feed">Feed</a>
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
  <div class="article-author-top">
    <img src="http://thesp0nge.com/images/myself.png" class="bio-photo" alt="Paolo Perego bio photo"></a>
<h3>Paolo Perego</h3>
<p>Specialista di application security italiano. 37 anni, milanese, papà, praticante di Taekwon-do ITF, chitarrista e blogger.</p>
<a href="https://twitter.com/thesp0nge" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>
<a href="http://facebook.com/thesp0nge" class="author-social" target="_blank"><i class="icon-facebook"></i> Facebook</a>



<a href="http://github.com/thesp0nge" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>



  </div>
  <article itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
    <div class="headline-wrap">
      <h1 itemprop="name">Is my connection really secure?</h1>
      <h2></h2>
    </div><!--/ .headline-wrap -->
    <div class="article-wrap" itemprop="text">
      <p>When you connect to a HTTPS server you must ensure the certificate is correct
before submitting sentitive data.
Modern browser do a lot of work for unexperienced users and if you see a green
lock, hopefully you can consider your communication to be secured.</p>

<p>But what about the penetration tester perspective?</p>

<h2 id="some-step-before">Some step before</h2>

<p>Days ago, I was attending a workshop showing how to break web applications and
the first step explained was fingerprint and information gathering.
SSLDigger, formerly by Foundstone, now a McAffee tool, was taken as example to
list all available ciphers in a HTTPS connection.</p>

<p>The tool is no longer maintained and it requires and old .NET libraries version
and, most important, it doesn’t run in a unix based environment.</p>

<!-- more -->

<h2 id="the-google-and-the-net">The Google and the Net</h2>

<p>In a second I found some great bash script for enumerating available scripts. 
Algorithm is quite basic:</p>

<p><code>
  given a protocol do
    for all ciphers openssl knows for that protocol do
      try open a connection and writing "GET / HTTP/1.0"
      if the server complains
        cipher is not supported
      else
        cipher is supported
      end
    end
  end 
</code></p>

<p>That’s it, in a minute I can use a script and venerable openssl tool to make
the same things SSLDigger ask me to download Megs of .NET 1.x libraries data.</p>

<h2 id="wait-im-a-ruby-fan-boy">Wait, I’m a ruby fan boy</h2>

<p>Ok, the script works fine but I want something more hackish I can tweak and I
can integrate in scripts or more complex software.</p>

<p>More of this I want more then enumerating ciphers, I want something tell me the
HTTPS connection can be hardened more or the supported protocol vs ciphers
combination is good enough,</p>

<p>Looking at the Net for ispiration I found a this ruby script in a blog (sorry,
I can’t retrieve it so if you’re reading and you’re the ssl_picker.rv daddy,
yes… write me down your blog url in the comments and I’ll check back this
post).</p>

<p>``` ruby ssl_picker.rb 
require ‘socket’
require ‘openssl’
require ‘net/https’</p>

<p>module Net
  class HTTP
    def set_context=(value)
      @ssl_context = OpenSSL::SSL::SSLContext.new
      @ssl_context &amp;&amp;= OpenSSL::SSL::SSLContext.new(value)
    end
    ssl_context_accessor :ciphers
  end
end</p>

<p>protocol_version = [:SSLv2, :SSLv3, :TLSv1]
protocol_version.each do |version|
  puts version
  cipher_set = OpenSSL::SSL::SSLContext.new(version).ciphers
  cipher_set.each do |cipher_name, cipher_version, bits, algorithm_bits|
    request = Net::HTTP.new(‘extranet.sky.it’, 443)
    request.use_ssl = true
    request.set_context = version
    request.verify_mode = OpenSSL::SSL::VERIFY_NONE
    request.ciphers = cipher_name
    begin
      response = request.get(“/”)
      puts “[+] Accepted\t #{bits} bits\t#{cipher_name}”
    rescue OpenSSL::SSL::SSLError =&gt; e
      puts “[-] Rejected\t #{bits} bits\t#{cipher_name}”
    rescue #Ignore all other Exceptions
    end
  end
end
```</p>

<p>Ok, this looks interesting but it doesn’t work with ruby 1.9.x anymore since
ssl_context_accessor was first deprecated and now removed from Net::HTTP.</p>

<p>So I taken the ssl_picker.rb script and I moved it further in a more complex
ruby gem <a href="https://github.com/thesp0nge/ciphersurfer">ciphersurfer</a></p>

<p>Of course, due to ssl_context_accessor thing, you can’t run the gem using 1.8.
Well true to be told I don’t test executing it with older rubies, I use the
<em>this ruby version is not supported</em> statement.</p>

<p>``` ruby lib/ciphersurfer/net_http.rb
require ‘socket’
require ‘net/https’
require ‘openssl’</p>

<p>module Net
  class HTTP
    def set_context=(value)
      @ssl_context = OpenSSL::SSL::SSLContext.new
      @ssl_context &amp;&amp;= OpenSSL::SSL::SSLContext.new(value)
    end</p>

<pre><code>def ciphers
  return nil unless @ssl_context
  @ssl_context.ciphers
end

def ciphers=(val)
  @ssl_context ||= OpenSSL::SSL::SSLContext.new
  @ssl_context.ciphers = val
end   end end ```
</code></pre>

<p>ssl_context_accessor in previous Net::HTTP API creates an accessor to a given
ssl_context attributes. I rather guess that API designers removed it since it’s
just an hack and it’s not a clear way to add pieces to the net framework.</p>

<p>I choose to be more polite, and added a getter/setter methods to ping newly
created ssl_context class variable.</p>

<p>The Ciphersurfer.Scanner class has two methods inside. A class method alive?
telling me if there is a server listening to a specific host:port.</p>

<p><code>ruby lib/ciphersurfer/scanner.rb
def self.alive?(host, port)
  request = Net::HTTP.new(host, port)
  request.use_ssl = true
  request.verify_mode = OpenSSL::SSL::VERIFY_NONE 
  begin
    response = request.get("/")
    return true
  rescue Errno::ECONNREFUSED =&gt; e
    return false
  rescue OpenSSL::SSL::SSLError =&gt; e
    return false
  end
end
</code> </p>

<p>The other method is the scanner routine that is very close to the original one.
It just returns ciphers ordered in arrays.</p>

<p><code>ruby lib/ciphersurfer/scanner.rb
def go
  cipher_set = OpenSSL::SSL::SSLContext.new(@proto).ciphers
  cipher_set.each do |cipher_name, cipher_version, bits, algorithm_bits|
    request = Net::HTTP.new(@host, @port)
    request.use_ssl = true
    request.set_context = @proto
    request.verify_mode = OpenSSL::SSL::VERIFY_NONE
    request.ciphers = cipher_name
    begin
      response = request.get("/")
      @ok_ciphers &lt;&lt; {:bits=&gt;bits, :name=&gt;cipher_name}
    rescue OpenSSL::SSL::SSLError =&gt; e
      @ko_ciphers &lt;&lt; {:bits=&gt;bits, :name=&gt;cipher_name}
    rescue 
      # Quietly discard all other errors... you must perform all error chekcs in the calling program
    end
  end
end
</code> </p>

<p>Gem binary is very simple as well. Just ask to scan for all known ciphers given a protocol.</p>

<p>``` ruby bin/ciphersurfer
protocol_version = [:SSLv2, :SSLv3, :TLSv1]
protocol_version.each do |version|
  puts version
  s = Ciphersurfer::Scanner.new({:host=&gt;ARGV[0], :port=&gt;ARGV[1], :proto=&gt;version})</p>

<p>s.go
  ok = s.ok_ciphers
  ko = s.ko_ciphers</p>

<p>ok.each do |o|
    puts “[+] Accepted\t #{o[:bits]} bits\t#{o[:name]}”
  end
end
``` </p>

<p>That’s all folks. So if you want to use the gem you must before install it the common way.</p>

<p><code>
gem install ciphersurfer
</code></p>

<p>Then you have a ciphersurfer script you can use it this way:</p>

<p><code>
ciphersurfer gmail.com 443
</code></p>

<p>Since it’s a 2 hour long hack it lacks a lot of thing:</p>

<ul>
  <li>pretty printing</li>
  <li>parameter checking</li>
  <li>help</li>
  <li>database support</li>
  <li>a little datamining</li>
</ul>

<p>As I said before I don’t want just to enumerate the ciphers, but I want to give
the user a feedback from the security point of view about the status of the
HTTPS server configuration.</p>

<p>The idea is to implement checks described into <a href="https://www.owasp.org/index.php/Testing_for_SSL-TLS_(OWASP-CM-001\)">Owasp Testing
guide</a>,
giving the user (hopefully a security analist) a brief evaluation in terms of
<em>ok, communication is secured here</em> or <em>no, ssl configuration must be locked
down further</em>.</p>

<p>Something even more I want to ad is a basic ORM support to save data in a SQL
form, <a href="http://datamapper.org">datamapper</a> I guess.</p>

      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          <img src="http://thesp0nge.com/images/myself.png" class="bio-photo" alt="Paolo Perego bio photo"></a>
<h3>Paolo Perego</h3>
<p>Specialista di application security italiano. 37 anni, milanese, papà, praticante di Taekwon-do ITF, chitarrista e blogger.</p>
<a href="https://twitter.com/thesp0nge" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>
<a href="http://facebook.com/thesp0nge" class="author-social" target="_blank"><i class="icon-facebook"></i> Facebook</a>



<a href="http://github.com/thesp0nge" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>



        </div>
        <p class="byline"><strong>Is my connection really secure?</strong> è stato scritto il <time datetime="2012-01-25T07:52:00+01:00" itemprop="datePublished">January 25, 2012</time> by <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name"><a href="http://thesp0nge.com/about" title="About Paolo Perego" itemprop="url">Paolo Perego</a></span></span>.</p>

        <div class='shareaholic-canvas' data-app='share_buttons' data-app-id='452298'></div>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'thesp0nge'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
      </footer>
    </div><!-- /.article-wrap -->
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <div class="related-articles">
  <h4>Vorresti anche leggere <small class="pull-right">(<a href="http://thesp0nge.com/la-dispensa">Sbircia nella dispensa</a>)</small></h4>
    <ul>
    
      <li><a href="http://thesp0nge.com/blog/announce-ciphersurfer-v1-dot-0-0" title="Announce: ciphersurfer v1.0.0">Announce: ciphersurfer v1.0.0</a></li>
    
      <li><a href="http://thesp0nge.com/blog/a_puzzle_for_an_appsec_quest" title="A puzzle for an appsec quest">A puzzle for an appsec quest</a></li>
    
      <li><a href="http://thesp0nge.com/blog/the_amazing_art_of_creating_apps" title="The amazing art of creating apps">The amazing art of creating apps</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    <span>The Kitchen v4.0.0.rc2 - &copy; 2014 Paolo Perego. Powered by <a href="http://jekyllrb.com">Jekyll</a> con una versione del tema <a href="http://mademistakes.com/">Minimal Mistakes</a> leggermente modificata.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://thesp0nge.com/javascripts/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://thesp0nge.com/javascripts/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-22580002-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

	        

</body>
</html>
