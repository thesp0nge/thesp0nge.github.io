<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Announce: ciphersurfer v1.0.0 &#8211; The Kitchen</title>
<meta name="description" content="">
<meta name="keywords" content="">
<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://thesp0nge.com/images/">
<meta name="twitter:title" content="Announce: ciphersurfer v1.0.0">
<meta name="twitter:description" content="Un blog che unisce foto, musica, vino, ricette e considerazioni sparse.">
<meta name="twitter:creator" content="@thesp0nge">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Announce: ciphersurfer v1.0.0">
<meta property="og:description" content="Un blog che unisce foto, musica, vino, ricette e considerazioni sparse.">
<meta property="og:url" content="http://thesp0nge.com/blog/announce-ciphersurfer-v1-dot-0-0">
<meta property="og:site_name" content="The Kitchen">





<link rel="canonical" href="http://thesp0nge.com/blog/announce-ciphersurfer-v1-dot-0-0">
<link href="http://thesp0nge.com/feed.xml" type="application/atom+xml" rel="alternate" title="The Kitchen Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="http://thesp0nge.com/stylesheets/main.min.css">

<!--[if (lt IE 9) & (!IEMobile)]>
<link rel="stylesheet" href="http://thesp0nge.com/stylesheets/ie.min.css">
<![endif]-->

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://thesp0nge.com/javascripts/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://thesp0nge.com/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://thesp0nge.com/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://thesp0nge.com/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://thesp0nge.com/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://thesp0nge.com/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://thesp0nge.com/images/apple-touch-icon-144x144-precomposed.png">

<script type="text/javascript">
//<![CDATA[
  (function() {
    var shr = document.createElement('script');
    shr.setAttribute('data-cfasync', 'false');
    shr.src = '//dsms0mj1bbhn4.cloudfront.net/assets/pub/shareaholic.js';
    shr.type = 'text/javascript'; shr.async = 'true';
    shr.onload = shr.onreadystatechange = function() {
      var rs = this.readyState;
      if (rs && rs != 'complete' && rs != 'loaded') return;
      var apikey = 'c5185a9d72e7109a2751eeb16046c3b4';
      try { Shareaholic.init(apikey); } catch (e) {}
    };
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(shr, s);
  })();
//]]>
</script>


</head>

<body class="article" itemscope itemtype="http://schema.org/WebPage">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://thesp0nge.com">The Kitchen</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
		    <ul>
		        
				<li><a href="http://thesp0nge.com/about" >Su di me</a></li>
		        
				<li><a href="http://thesp0nge.com/la-dispensa" >La dispensa</a></li>
		        
				<li><a href="http://thesp0nge.com/parlami" >Parlami</a></li>
		        
				<li><a href="http://armoredcode.com" target="_blank">Armoredcode</a></li>
		        
		        <li><i class="icon-feed"></i> <a href="http://thesp0nge.com/feed.xml" title="Atom/RSS feed">Feed</a>
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
  <div class="article-author-top">
    <img src="http://thesp0nge.com/images/myself.png" class="bio-photo" alt="Paolo Perego bio photo"></a>
<h3>Paolo Perego</h3>
<p>Specialista di application security italiano. 37 anni, milanese, papà, praticante di Taekwon-do ITF, chitarrista e blogger.</p>
<a href="https://twitter.com/thesp0nge" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>
<a href="http://facebook.com/thesp0nge" class="author-social" target="_blank"><i class="icon-facebook"></i> Facebook</a>



<a href="http://github.com/thesp0nge" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>



  </div>
  <article itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
    <div class="headline-wrap">
      <h1 itemprop="name">Announce: ciphersurfer v1.0.0</h1>
      <h2></h2>
    </div><!--/ .headline-wrap -->
    <div class="article-wrap" itemprop="text">
      <p>After a week since the first
<a href="http://thesp0nge.com/blog/2012/01/25/is-my-connection-really-secure/">post</a>
about ciphersurfer and the early stage of testing an HTTPS communication, the
first <strong>major</strong> release it’s available.</p>

<p>The project goals are now slightly different than just enumerating ciphers an
HTTPS server supports. Now a full evaluation is performed over the SSL
configuration giving a score using <a href="https://www.ssllabs.com/downloads/SSL_Server_Rating_Guide_2009.pdf">SSLabs document</a>
as reference guide. </p>

<!-- more -->

<p>The HTTPS connection is evaluated for <em>three</em> KPIs:</p>

<ul>
  <li>protocols the server supports</li>
  <li>cipher length</li>
  <li>certificate key length</li>
</ul>

<p>The application you can find to the <a href="https://www.ssllabs.com">SSLabs website</a>
also gives an additional score for the certificate but, since the last one
doesn’t infere with the overall security score, I decided not to hack further
and hit the web with a 1.0.0 release.</p>

<p>For the ones scared about what the tool does in order to evaluate your website
security configuration, ciphersurfer performs neither of the followings:</p>

<ul>
  <li>denial of service attacks</li>
  <li>cross site scripting or injection attempts</li>
  <li>data manipulation or leakage</li>
</ul>

<p>The requests the tool makes are just an HTTP GET / of target website to ensure
the server accept an HTTP communication given a SSL protocol and cipher
proposed by the client. No more. Really, ciphersurer won’t hurt your webserver,
nor your business. </p>

<p>If you don’t trust this disclaimer, just check the source code.</p>

<h2 id="installing-ciphersurfer">Installing ciphersurfer</h2>

<p>ciphersurfer is deployed as standard gem served by
<a href="http://rubygems.org">rubygems</a>. </p>

<p>To install latest ciphersurfer stable release, just issue this command:</p>

<p><code>
gem install ciphersurfer
</code></p>

<p>If you want to install a <em>pre</em> release, such as a <em>release candidate</em> you can do it this way:</p>

<p><code>
gem install ciphersurfer --pre
</code></p>

<p>I recommend you to install <a href="https://rvm.beginrescueend.com/">rvm</a> in order to
have your gem binaries tool installed in your home directory, otherwise
ciphersurfer will try to install itself in standard /usr/bin directory if no
other flags are passed to gem command.</p>

<h2 id="using-ciphersurfer">Using ciphersurfer</h2>

<p>After ciphersurfer has been installed, using it it’s very simple.</p>

<p>To evaluate secure communication with the target host <em>test-this.com</em> at the
standard HTTPS port, you just give the tool the target name as option:</p>

<p><code>
ciphersurfer test-this.com
</code> </p>

<p>As output you will see an evaluation for HTTPS test-this.com configuration. 
The evaluation scale is:</p>

<ul>
  <li>A: <em>prime class</em> HTTPS configuration. Servers handling <strong>very</strong> sensitive
information</li>
  <li>B: strong HTTPS configuration, suitable for must production servers</li>
  <li>C: quite goot HTTPS configuration. If your web server is a private server and
for development or testing purposes, it can be acceptable. If your server is
exposed to the Internet, you want to improve your SSL configuration.</li>
  <li>D: poor HTTPS configuration. Suitable <strong>only</strong> for development machines.</li>
  <li>E: weak HTTPS configuration. You really don’t want to have this score</li>
</ul>

<p>As example, this is the evaluation for <a href="https://www.pec.it">www.pec.it</a>, ran
with official 1.0.0 ruby gem.</p>

<p><img src="/images/ciphersurfer_eval-1036x175-5ceeac.png" /></p>

<p>You can also just listen ciphers supported by your web server instead of having
an SSL evaluation:</p>

<p>``` 
$ ciphersurfer -l gmail.com </p>

<p>“Evaluating secure communication with gmail.com:443”
“[+] accepted RC4-MD5”
“[+] accepted AES256-SHA”
“[+] accepted DES-CBC3-SHA”
“[+] accepted AES128-SHA”
“[+] accepted RC4-SHA”
``` </p>

<h2 id="show-me-the-code-dude">Show me the code dude</h2>

<p>Funny isn’t it? Well the code has changed a lot since last post.</p>

<p>The first <em>major</em> change is that for all regular HTTP GETs, the ruby library
<strong>httpclient</strong> has been used instead of cooking a connection using Net::HTTP
class. This because httpclient makes me easy to grab the server certificate
since it bundles all root CAs without them Net::HTTP class won’t give me
anything as peer certificate.</p>

<p>This is the routine available at Ciphersurfer::Scanner.alive? It just checks if
a server answers if prompted for the root page. As you can see we grab also the
certificate so we don’t need to bother the target with another get just to take
it.</p>

<p>``` ruby lib/ciphersurfer/scanner.rb
def self.alive?(host, port)
  client=HTTPClient.new
  begin
    @alive=true
    response=client.get(“https://#{host}:#{port}”)
    @peer_cert = response.peer_cert
    return true
  rescue =&gt; e
    puts “alive?(): #{e.message}”.color(:red)
    return false
  end</p>

<p>end
```</p>

<p>The core scanning method hasn’t changed a lot. Just a minor difference in how
results are stored.</p>

<p>``` ruby lib/ciphersurfer/scanner.rb
def go
  context=OpenSSL::SSL::SSLContext.new(@proto)
  cipher_set = context.ciphers
  cipher_set.each do |cipher_name, cipher_version, bits, algorithm_bits|</p>

<pre><code>request = Net::HTTP.new(@host, @port)
request.use_ssl = true
request.verify_mode = OpenSSL::SSL::VERIFY_NONE
request.ciphers= cipher_name
begin
  response = request.get("/")
  @ok_bits &lt;&lt; bits
  @ok_ciphers &lt;&lt; cipher_name
rescue OpenSSL::SSL::SSLError =&gt; e
  # Quietly discard SSLErrors, really I don't care if the cipher has
  # not been accepted
rescue 
  # Quietly discard all other errors... you must perform all error
  # chekcs in the calling program
end   end end ```
</code></pre>

<p>Here we don’t use httpclient helpers since I want to play with different
ciphers at time.</p>

<p>That’s it. All the magic happens there. Now, let’s look like at the bin script to see how the scoring system has been used.</p>

<p>First of all, we must scan the target for all the protocols we support.</p>

<p>``` ruby bin/ciphersurfer
protocol_version.each do |version|
  s = Ciphersurfer::Scanner.new({:host=&gt;host, :port=&gt;port, :proto=&gt;version})</p>

<p>s.go
  if (s.ok_ciphers.size != 0)
    supported_protocols « version
    cipher_bits = cipher_bits | s.ok_bits
    ciphers = ciphers | s.ok_ciphers
  end</p>

<p>end
```</p>

<p>Now we’ve got supported_protocols that stores all the protocols the server
supports, and cipher_bits that stores all the ciphers length in bits. We want
the certificate now.</p>

<p><code>ruby bin/ciphersurfer
cert= Ciphersurfer::Scanner.cert(host, port)
if ! cert.nil?
  a=cert.public_key.to_text
  key_size=/Modulus \((\d+)/i.match(a)[1]
else
  puts "warning: the server didn't give us the certificate".color(:yellow)
  key_size=0
end
</code></p>

<p>Note that we don’t make another GET here since we did it at the beginning of
the engagement when we checked if the target was alive or not.</p>

<p>Now, let’s calculate the scores, all of them in a 0..100 range.</p>

<p><code>ruby bin/ciphersurfer
proto_score=  Ciphersurfer::Score.evaluate_protocols(supported_protocols)
cipher_score= Ciphersurfer::Score.evaluate_ciphers(cipher_bits)
key_score=    Ciphersurfer::Score.evaluate_key(key_size.to_i)
score=        Ciphersurfer::Score.score(proto_score, key_score, cipher_score)
</code></p>

<p>And then, some graphics to make the experience more appealing.</p>

<p><code>ruby bin/ciphersurfer
printf "%20s : %s (%s)\n", "Overall evaluation", Ciphersurfer::Score.evaluate(score), score.to_s
printf "%20s : ", "Protocol support" 
proto_score.to_i.times{print 'o'.color(score_to_color(proto_score))}
puts ' ('+proto_score.to_s+')'
printf "%20s : ",  "Key exchange" 
key_score.to_i.times{print 'o'.color(score_to_color(key_score))}
puts ' ('+key_score.to_s+')'
printf "%20s : ", "Cipher strength" 
cipher_score.to_i.times{print 'o'.color(score_to_color(cipher_score))}
puts ' ('+cipher_score.to_s+')'
</code></p>

<p>Results can be optained also in a JSON format, so ciphersurfer can be embedded
in other tools or even in a web app.</p>

<h2 id="further-improvements">Further improvements</h2>

<p>Well, the major improvement I’m going to introduce later on is a scan on some
certificate parameter to check if the certficate is still valid or if it’s self
signed or if it matches the FQDN the tester asked.</p>

<p>Later some sort of persistence in a SQL database will be introduced to save the
scan history for a given target, in order to make evaluation over time if
actions were taken to improve HTTPS configuration or not.</p>

      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          <img src="http://thesp0nge.com/images/myself.png" class="bio-photo" alt="Paolo Perego bio photo"></a>
<h3>Paolo Perego</h3>
<p>Specialista di application security italiano. 37 anni, milanese, papà, praticante di Taekwon-do ITF, chitarrista e blogger.</p>
<a href="https://twitter.com/thesp0nge" class="author-social" target="_blank"><i class="icon-twitter"></i> Twitter</a>
<a href="http://facebook.com/thesp0nge" class="author-social" target="_blank"><i class="icon-facebook"></i> Facebook</a>



<a href="http://github.com/thesp0nge" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>



        </div>
        <p class="byline"><strong>Announce: ciphersurfer v1.0.0</strong> è stato scritto il <time datetime="2012-02-01T07:48:00+01:00" itemprop="datePublished">February 01, 2012</time> by <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name"><a href="http://thesp0nge.com/about" title="About Paolo Perego" itemprop="url">Paolo Perego</a></span></span>.</p>

        <div class='shareaholic-canvas' data-app='share_buttons' data-app-id='452298'></div>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'thesp0nge'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
      </footer>
    </div><!-- /.article-wrap -->
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <div class="related-articles">
  <h4>Vorresti anche leggere <small class="pull-right">(<a href="http://thesp0nge.com/la-dispensa">Sbircia nella dispensa</a>)</small></h4>
    <ul>
    
      <li><a href="http://thesp0nge.com/blog/is-my-connection-really-secure" title="Is my connection really secure?">Is my connection really secure?</a></li>
    
      <li><a href="http://thesp0nge.com/blog/a_puzzle_for_an_appsec_quest" title="A puzzle for an appsec quest">A puzzle for an appsec quest</a></li>
    
      <li><a href="http://thesp0nge.com/blog/the_aurora_project" title="The aurora project">The aurora project</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    <span>The Kitchen v4.0.0.rc2 - &copy; 2014 Paolo Perego. Powered by <a href="http://jekyllrb.com">Jekyll</a> con una versione del tema <a href="http://mademistakes.com/">Minimal Mistakes</a> leggermente modificata.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://thesp0nge.com/javascripts/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://thesp0nge.com/javascripts/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-22580002-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

	        

</body>
</html>
