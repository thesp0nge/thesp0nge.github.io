---
layout: post
title: 'pernataleiovorrei: day #1'
categories:
- Simple life
tags: []
status: publish
type: post
published: true
meta:
  delicious: a:3:{s:5:"count";s:1:"0";s:9:"post_tags";s:0:"";s:4:"time";s:10:"1288377624";}
  reddit: a:2:{s:5:"count";s:1:"0";s:4:"time";s:10:"1288377626";}
  _elasticsearch_indexed_on: '2010-10-19 10:37:12'
---
<div class='posterous_autopost'>Ieri sera non sono riuscito ad andare ad allenarmi. Piegato in due dai crampi addominali. Vabbé poco male nel giorno dove scopro che amo gli <a href="http://aliceinchains.com/">Alice in chains</a>.<div> Decido, dopo aver fatto il papà di lavorare su <a href="http://pernataleiovorrei.com">pernataleiovorrei.com</a>, la data dove vorrei lanciare si avvicina (lunedì prossimo) e mancano troppo funzionalità almeno per taggarlo come <a href="http://en.wikipedia.org/wiki/Minimum_viable_product">prodotto minimale</a>. </div> <p /><div>Prima di tutto, una premessa. Fino ad ora l&#039;autenticazione è fatta attraverso la gemma <a href="http://github.com/plataformatec/devise">devise</a>, che però non mi aiuta per autenticare i miei utenti via twitter o ancora meglio via facebook.</div> <p /><div>Cosa che invece fa la gemma <a href="http://github.com/intridea/omniauth">omniauth</a>. Grazie ai podcast dei ragazzi di <a href="http://railscasts.com">railscasts.com</a> sono riuscito a completare l&#039;autenticazione via twitter e stasera metterò in piedi quella via facebook.</div> <p /><div>Un piccolo bug, questo è il codice del mio metodo create per il controller Authentication. Ha un piccolo bug; in realtà si riesce ad associare ad un utente <b>già loggato</b> su <a href="http://pernataleiovorrei.com">pernataleiovorrei.com</a> l&#039;utenza twitter ma non quando l&#039;utente non è loggato.</div> <p /><div>Troverò l&#039;inghippo... deve essere una fesseria ma ieri ho finito all&#039;una di notte.</div><div> <div class="data type-ruby">  <table cellspacing="0" cellpadding="0"> <tr> <td> <pre class="line_numbers"><span id="LID1">1</span> <span id="LID2">2</span> <span id="LID3">3</span> <span id="LID4">4</span> <span id="LID5">5</span> <span id="LID6">6</span> <span id="LID7">7</span> <span id="LID8">8</span> <span id="LID9">9</span> <span id="LID10">10</span> <span id="LID11">11</span> </pre> </td> <td width="100%">  <div class="highlight"><pre /><div class="line" id="LC1"><span class="k">def</span> <span class="nf">create</span></div><div class="line" id="LC2">&nbsp;&nbsp;<span class="n">omniauth</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">env</span><span class="o">[</span><span class="s2">"omniauth.auth"</span><span class="o">]</span></div><div class="line" id="LC3">&nbsp;&nbsp;<span class="n">authentication</span> <span class="o">=</span> <span class="no">Authentication</span><span class="o">.</span><span class="n">find_by_provider_and_uid</span><span class="p">(</span><span class="n">omniauth</span><span class="o">[</span><span class="s1">&#039;provider&#039;</span><span class="o">]</span><span class="p">,</span> <span class="n">omniauth</span><span class="o">[</span><span class="s1">&#039;uid&#039;</span><span class="o">]</span><span class="p">)</span></div><div class="line" id="LC4">&nbsp;&nbsp;<span class="k">if</span> <span class="n">authentication</span></div><div class="line" id="LC5">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">sign_in_and_redirect</span><span class="p">(</span><span class="ss">:user</span><span class="p">,</span> <span class="n">authentication</span><span class="o">.</span><span class="n">user</span><span class="p">)</span></div><div class="line" id="LC6">&nbsp;&nbsp;<span class="k">else</span></div><div class="line" id="LC7">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">current_user</span><span class="o">.</span><span class="n">authentications</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:provider</span><span class="o">=&gt;</span><span class="n">omniauth</span><span class="o">[</span><span class="s1">&#039;provider&#039;</span><span class="o">]</span><span class="p">,</span> <span class="ss">:uid</span><span class="o">=&gt;</span><span class="n">omniauth</span><span class="o">[</span><span class="s1">&#039;uid&#039;</span><span class="o">]</span><span class="p">)</span></div><div class="line" id="LC8">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"You rock man"</span></div><div class="line" id="LC9">&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">redirect_to</span> <span class="n">authentications_url</span></div><div class="line" id="LC10">&nbsp;&nbsp;<span class="k">end</span></div><div class="line" id="LC11"><span class="k">end</span></div></pre></div>  </td> </tr> </table>  </div><p /></div><div>Potrei, non prometto nulla, mettere online su <a href="http://heroku.com">heroku.com</a> il tutto già da domani così da far giocare i miei utenti più smaliziati. Di sicuro la grafica è da rendere più carina così come l&#039;interazione con l&#039;utente.</div> <p /><div><b>ATTENZIONE</b>: se andate su <a href="http://www.pernataleiovorrei.com">www.pernataleiovorrei.com</a>, <a href="http://heroku.com">heroku.com</a> vi da un errore. Devo sistemare bene i redirect, il link è <a href="http://pernataleiovorrei.com">pernataleiovorrei.com</a>, per adesso senza il www.</div></div>
